{"version":3,"sources":["webpack://Peace.AsyncValidator/webpack/universalModuleDefinition","webpack://Peace.AsyncValidator/webpack/bootstrap","webpack://Peace.AsyncValidator/./index.js","webpack://Peace.AsyncValidator/./src/message_generator.js","webpack://Peace.AsyncValidator/./src/messages_zh_CN.js","webpack://Peace.AsyncValidator/./src/required_if.js","webpack://Peace.AsyncValidator/./src/requires.js","webpack://Peace.AsyncValidator/./src/rules.js","webpack://Peace.AsyncValidator/./src/unique.js","webpack://Peace.AsyncValidator/external \"axios\"","webpack://Peace.AsyncValidator/external {\"root\":[\"Peace\",\"Core\"],\"commonjs\":\"peacetrue-js/src/core\",\"commonjs2\":\"peacetrue-js/src/core\",\"amd\":\"peacetrue-js/src/core\"}"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC;AACrC,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;AClFA,YAAY,mBAAO,CAAC,mCAAa;AACjC,eAAe,mBAAO,CAAC,yCAAgB;AACvC,eAAe,mBAAO,CAAC,+CAAmB;AAC1C,eAAe,mBAAO,CAAC,qCAAc;;AAErC,gBAAgB,mBAAO,CAAC,2DAAyB;;AAEjD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,kBAAkB,uC;;;;;;;;;;;ACjBlB,eAAe,mBAAO,CAAC,iDAAkB;;AAEzC;AACA,SAAS;AACT,YAAY;AACZ,YAAY;AACZ;AACA,SAAS;AACT,YAAY;AACZ,YAAY;AACZ;;AAEA;AACA,cAAc;AACd;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,E;;;;;;;;;;;AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACpEA,WAAW,mBAAO,CAAC,oDAAuB;;AAE1C;AACA;AACA,SAAS,4BAA4B;AACrC;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,cAAc,OAAO,OAAO,yBAAyB,OAAO,0BAA0B,OAAO,KAAK,OAAO;AACzG;;;;;;;;;;;;ACbA,WAAW,mBAAO,CAAC,oDAAuB;;AAE1C;AACA;AACA,SAAS,aAAa;AACtB;AACA;AACA;AACA,KAAK;AACL,cAAc,cAAc,OAAO,0BAA0B,OAAO;AACpE;;;;;;;;;;;;ACVA,WAAW,mBAAO,CAAC,oDAAuB;;AAE1C;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD;AACjD;AACA,8CAA8C;AAC9C;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,qBAAqB;AACrB;AACA;AACA,iBAAiB;AACjB,oDAAoD,6BAA6B;AACjF;AACA,aAAa;AACb,SAAS;AACT;AACA;;AAEA;AACA,aAAa;AACb,gBAAgB;AAChB,cAAc;AACd;AACA,kBAAkB;AAClB;;AAEA;AACA,QAAQ,kDAAkD;AAC1D;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,8BAA8B,gBAAgB;AAC9C,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,E;;;;;;;;;;;AChFA,WAAW,mBAAO,CAAC,oDAAuB;AAC1C,YAAY,mBAAO,CAAC,oBAAO;;AAE3B;AACA;AACA,SAAS,sCAAsC;AAC/C;AACA;;AAEA;AACA;;AAEA,oEAAoE,+BAA+B;AACnG,yCAAyC,gCAAgC;;AAEzE;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA,oEAAoE;AACpE;AACA;;AAEA;AACA,mCAAmC,eAAe;AAClD;AACA;AACA;AACA;AACA,iBAAiB;AACjB,KAAK;AACL,cAAc,OAAO,OAAO,6BAA6B,OAAO;AAChE;;;;;;;;;;;;ACpCA,mD;;;;;;;;;;;ACAA,mE","file":"peace.async-validator.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"axios\"), require(\"peacetrue-js/src/core\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"axios\", \"peacetrue-js/src/core\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"AsyncValidator\"] = factory(require(\"axios\"), require(\"peacetrue-js/src/core\"));\n\telse\n\t\troot[\"Peace\"] = root[\"Peace\"] || {}, root[\"Peace\"][\"AsyncValidator\"] = factory(root[\"axios\"], root[\"Peace\"][\"Core\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_axios__, __WEBPACK_EXTERNAL_MODULE_peacetrue_js_src_core__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./index.js\");\n","let Rules = require('./src/rules');\nRules.register(require('./src/requires'));\nRules.register(require('./src/required_if'));\nRules.register(require('./src/unique'));\n\nlet Generator = require('./src/message_generator');\n\nfunction setField(name, desc) {\n    Rules.setField(name, desc);\n    Generator.setField(name, desc);\n}\n\nfunction setFields(name, desc) {\n    Rules.setFields(name, desc);\n    Generator.setFields(name, desc);\n}\n\nmodule.exports = {Rules, Generator, setField, setFields};","let messages = require('./messages_zh_CN');\n\n/*\n* name: {type:'string',required:true,min:2,max:6}\n* => name: {required:true,message:'%s 是必须的'}\n* => name: {required:true,message:'姓名 是必须的'}\n*\n* name: {type:'string'}\n* => name: {type:'string',message:'%s 不是一个 %s'}\n* => name: {type:'string',message:'名称 不是一个 字符串'}\n*/\n\nmodule.exports = {\n    fields: {},\n    setField(name, desc) {\n        this.fields[name] = desc;\n        return this;\n    },\n    setFields(fields) {\n        Object.assign(this.fields, fields);\n        return this;\n    },\n    generate(descriptor, fields) {\n        fields = Object.assign({}, this.fields, fields);\n        Object.keys(descriptor).forEach(field => {\n            let rules = descriptor[field];\n            if (!Array.isArray(rules)) rules = [rules];\n            let typeRuleValue;\n            rules.forEach((rule, i) => {\n                let ruleName = Object.keys(rule)[0];\n                let ruleValue = rule[ruleName];\n                if (i === 0) typeRuleValue = ruleName !== 'type' ? 'string' : ruleValue;\n                //已指定消息或者自定义的规则 不处理\n                if (rule.message || rule.validator || rule.asyncValidator) return;\n                console.info(rule, typeRuleValue, ruleName, ruleValue);\n                let message;\n                switch (ruleName) {\n                    case 'type':\n                        message = messages.messages.types[ruleValue];\n                        message = message.replace('%s', fields[field]);\n                        message = message.replace('%s', messages.types[ruleValue]);\n                        rule.message = message;\n                        break;\n                    case 'default':\n                    case 'required':\n                    case 'enum':\n                    case 'whitespace':\n                        message = messages.messages[ruleName];\n                        message = message.replace('%s', fields[field]);\n                        message = message.replace('%s', ruleValue);\n                        rule.message = message;\n                        break;\n                    default:\n                        message = messages.messages[typeRuleValue][ruleName];\n                        message = message.replace('%s', fields[field]);\n                        message = message.replace('%s', ruleValue);\n                        rule.message = message;\n                        break;\n                }\n            });\n        });\n        return descriptor;\n    }\n};","module.exports = {\n    messages: {\n        'default': '字段 %s 验证错误',\n        required: '%s 是必须的',\n        'enum': '%s 必须是 %s 中之一',\n        whitespace: '%s 不能为空',\n        date: {\n            format: '%s 日期 %s 对于格式 %s 是无效的',\n            parse: '%s 日期不能够被解析, %s 是无效的 ',\n            invalid: '%s 日期 %s 是无效的'\n        },\n        types: {\n            string: '%s 不是一个 %s',\n            method: '%s 不是一个 %s (function)',\n            array: '%s 不是一个 %s',\n            object: '%s 不是一个 %s',\n            number: '%s 不是一个 %s',\n            date: '%s 不是一个 %s',\n            boolean: '%s 不是一个 %s',\n            integer: '%s 不是一个 %s',\n            float: '%s 不是一个 %s',\n            regexp: '%s 不是一个有效的 %s',\n            email: '%s 不是一个有效的 %s',\n            url: '%s 不是一个有效的 %s',\n            hex: '%s 不是一个有效的 %s'\n        },\n        string: {\n            len: '%s 必须精确地是 %s 个字符',\n            min: '%s 必须至少是 %s 个字符',\n            max: '%s 不能够长于 %s 个字符',\n            range: '%s 必须在 %s 和 %s 个字符之间'\n        },\n        number: {\n            len: '%s 必须等于 %s',\n            min: '%s 不能小于 %s',\n            max: '%s 不能大于 %s',\n            range: '%s 必须在 %s 和 %s 之间'\n        },\n        array: {\n            len: '%s 长度必须精确地是 %s ',\n            min: '%s 长度不能小于 %s ',\n            max: '%s 长度不能大于 %s',\n            range: '%s 长度必须在 %s 和 %s 之间'\n        },\n        pattern: {\n            mismatch: '%s 值 %s 不能匹配规则 %s'\n        },\n        clone: function clone() {\n            let cloned = JSON.parse(JSON.stringify(this));\n            cloned.clone = this.clone;\n            return cloned;\n        }\n    },\n    types: {\n        string: '字符串',\n        method: '方法',\n        array: '数组',\n        object: '对象',\n        number: '数字',\n        date: '日期',\n        boolean: '布尔值',\n        integer: '整数',\n        float: '小数',\n        regexp: '正则表达式',\n        email: '邮件地址',\n        url: '网址',\n        hex: '16进制格式'\n    }\n};\n","let Core = require('peacetrue-js/src/core');\n\nmodule.exports = {\n    name: 'requiredIf',\n    /** {source:String,target:String} */\n    rule: function (rule, value, callback, source, options) {\n        if (Core.isEmpty(value)) return true;\n        let ruleOptions = rule.requiredIf;\n        return Core.isEmpty(value[ruleOptions.source])\n            ? true\n            : !Core.isEmpty(value[ruleOptions.target]);\n    },\n    message: {'*': '{target} must have a value when {source} has a value', 'zh_CN': '{source}有值时，{target}必须有值'}\n};\n","let Core = require('peacetrue-js/src/core');\n\nmodule.exports = {\n    name: 'requires',\n    /** {fields:Array} */\n    rule: function (rule, value, callback, source, options) {\n        if (Core.isEmpty(value)) return true;\n        return rule.requires.fields.filter(name => !Core.isEmpty(value[name])).length > 0;\n    },\n    message: {'*': 'one of {fields} is required', 'zh_CN': '{fields}中至少一个有值'}\n};\n","let Core = require('peacetrue-js/src/core');\n\nfunction join(name) {\n    return {\n        validator(rule, value, callback, source, options) {\n            let result = Rules.rules[name].apply(this, arguments);\n            if (!(result instanceof Promise)) result = Promise.resolve(result);\n            result.then(isValid => {\n                if (isValid === 'ignored') return;//请求出错时，无法判断是成功还是失败，忽略此次验证\n                if (isValid === true) return callback();\n                //规则选项\n                let ruleOptions = rule[name];\n                //消息国际化\n                let message = ruleOptions.message || options.messages[name] || Rules.messages[name][Rules.lang] || Rules.messages[name]['*'];\n                //当前字段名本地化\n                let field = (options.fields || {})[rule.field] || Rules.fields[rule.field] || rule.field;\n                //选项字段名本地化\n                ruleOptions = Object.assign({}, ruleOptions);\n                Object.keys(ruleOptions).forEach(key => {\n                    let values = ruleOptions[key];\n                    if (Array.isArray(values)) {\n                        values.forEach((value, i) => {\n                            (value in Rules.fields) && (values[i] = Rules.fields[value]);\n                        });\n                    } else {\n                        (value in Rules.fields) && (ruleOptions[key] = Rules.fields[value]);\n                    }\n                });\n                let messageOptions = Object.assign({_field: field, _value: value}, ruleOptions);\n                callback(new Error(Core.format(message, messageOptions)));\n            });\n        },\n    };\n}\n\nconst Rules = {\n    rules: {},\n    messages: {},\n    fields: {},\n    lang: 'zh_CN',\n    validators: {},\n};\n\nmodule.exports = {\n    /**{name:String, rule:Function, message:String|Object}*/\n    register(options) {\n        Rules.rules[options.name] = options.rule;\n        this.setMessage(options.name, options.message);\n        Rules.validators[options.name] = join(options.name);\n        return this;\n    },\n    use(name, options) {\n        return Object.assign({[name]: options}, Rules.validators[name]);\n    },\n    setLang(lang = 'en') {\n        Rules.lang = lang;\n        return this;\n    },\n    setMessage(name, message, lang = '*') {\n        if (typeof message === 'string') {\n            Rules.messages[name][lang] = message;\n        } else {\n            Rules.messages[name] = message;\n        }\n        return this;\n    },\n    setMessages(messages, lang = \"*\") {\n        Object.keys(messages).forEach(key => {\n            Rules.messages[key][lang] = messages[key];\n        });\n        return this;\n    },\n    setField(name, desc) {\n        Rules.fields[name] = desc;\n        return this;\n    },\n    setFields(names) {\n        Object.assign(Rules.fields, names);\n        return this;\n    },\n};","let Core = require('peacetrue-js/src/core');\nlet Axios = require('axios');\n\nmodule.exports = {\n    name: 'unique',\n    /** {url:String,params:Function,original:*} */\n    rule: function (rule, value, callback, source, options) {\n        if (Core.isEmpty(value)) return true;\n\n        let ruleOptions = rule.unique;\n        if (value === ruleOptions.original) return true;\n\n        !ruleOptions.params && (ruleOptions.params = (options) => ({[options.field]: options.value}));\n        let params = ruleOptions.params({field: rule.field, value: value});\n\n        // ruleOptions.params\n        // && Object.keys(ruleOptions.params).forEach(key => {\n        //     let value = rule.unique.params[key];\n        //     params[key] = value instanceof Function ? value() : value;\n        // });\n        //\n        // let original = ruleOptions.original;\n        // if (original) {\n        //     if (Core.getType(original) !== 'object') original = {[rule.field]: original};\n        //     if (Object.keys(params).filter(key => params[key] !== original[key]).length === 0) return true;\n        // }\n\n        return Axios\n            .get(ruleOptions.url, {params: params})\n            .then(t => Promise.resolve(ruleOptions.successHandler ? ruleOptions.successHandler(t) : t),\n                t => {\n                    ruleOptions.errorHandler && ruleOptions.errorHandler(t);\n                    return Promise.resolve('ignored');\n                });\n    },\n    message: {'*': '{_field} must be unique', 'zh_CN': '{_field} 必须是唯一的'}\n};\n","module.exports = __WEBPACK_EXTERNAL_MODULE_axios__;","module.exports = __WEBPACK_EXTERNAL_MODULE_peacetrue_js_src_core__;"],"sourceRoot":""}